 {% extends "base.html" %}
{% comment %}
        Template permettant l'affichage de l'intégralité du POST ainsi que les commentaires qui lui sont associés.
        Un utilisateur, en fonction de son niveau d'autorisation, aura accès à plusieurs fonctionnalités.
{% endcomment %}

{% block title %} Voici la liste des commentaires !{% endblock title %}

{% block h1 %} Commentaires de {{ post.title }}! {% endblock h1 %}

{% block h3 %}

    {# Inclusion template pour afficher le post #}
    {% include 'communitymanager/un_post.html' with  page='post' btn_like=True %}

    {# Affichage des commentaires du post #}
    {% for commentaire in commentaires %}

        {% if not commentaire.invisible or request.user in post.communaute.list_CMs.all %}
            <div class="media p-3">
                <div class="media-body">
                    <p>{{ commentaire.contenu }}</p>
                    <h4>
                        <i class="fas fa-user-edit"></i> {{ commentaire.auteur }}
                        {% if request.user in post.communaute.list_CMs.all %}
                        {# possibilité de Bannir un utilisateur si l'utilisateur est toujours dans la communauté, si l'auteur n'est pas un CM, et si l'auteur du commentaire est dans la liste des abonnés #}
                            {% if not commentaire.auteur.is_superuser and not commentaire.auteur.id in post.communaute.list_CMs.user_id and commentaire.auteur in post.communaute.abonnes.all %}
                                <a span href="{% url 'bannir' communaute_id=post.communaute.id user_id=commentaire.auteur.id %}">
                                    <i class="fas fa-ban"></i>
                                </a>
                            {% endif %}
                        {% endif %}
                        <small><i>{{ commentaire.date_creation }}</i></small>
                        {% if request.user in post.communaute.list_CMs.all %}
                        {# Si l'utilisateur est un CM, il pourra rendre visible/invisible un commentaire  #}
                            {% if commentaire.invisible %}
                                <a span href="{% url 'visibilite_commentaire' commentaire.id %}"><i class="far fa-eye-slash"></i></a>
                            {% else %}
                                <a span href="{% url 'visibilite_commentaire' commentaire.id %}"><i class="far fa-eye"></i></a>
                            {% endif %}
                        {% endif %}
                    </h4>
                </div>
            </div>
            <hr class="my-4"/>
        {% endif %}

    {% endfor %}

    {# Section pour ajouter un commentaire si la communauté n'est pas fermée #}
    {% if not post.communaute.ferme%}
        <div> Commentez!</div>
        {% if envoi %}Votre commentaire a bien été envoyé !{% endif %}
        <form action="{% url 'post' post.id %}" method="post">
            {% csrf_token %}
            <p>{{ form.contenu}}</p>
            <input type="submit" value="Ajoutez un commentaire..."/>
        </form>
    {% else %}
        Ce POST est fermé, vous ne pouvez plus le commenter.
    {% endif %}

{% endblock h3 %}
